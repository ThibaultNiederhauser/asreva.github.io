---
layout: post
title: What factors influence friendships?
gh-repo: daattali/beautiful-jekyll
comments: true
--- 

{: .box-note}
*"A friend is one that knows you as you are, understands where you have been, accepts what you have become, and still, gently allows you to grow."* -William Shakespeare

{: .box-note}
*"Some people go to priests, others to poetry. I go to my friends."* -Virginia Woolf

{: .box-note}
*"There is nothing better than a friend, unless it is a friend with chocolate."* -Linda Grayson 

<span style="color:blue">GENERAL WARNINGS: CHECK ENGLISH + UPDATE PLOTS IF NEEDED</span>

# Introduction

Friendship is a significant component of social life in most cultures. But are the friendships behaviours identical among countries? Do the politic, the economy or the geography of the country influence the way of friendship is expressed? That is what we will study.

Determining what can favour friendship is a powerful tool to fight the threats of isolation and depression, that are growing each year across the world (especially in "westernized" countries). In some countries, like Japan, a name exists to define a person that completely withdraws from society: Hikikomori (<https://en.wikipedia.org/wiki/Hikikomori>). In addition to this tendency, the 2020's sanitary crisis forced a lot of people to isolate themself. That's why understanding friendship is more crucial than ever.

To do so, we will use data from two social media; from them, we will be able to compute quantitative as well as qualitative friendship characteristics for each country. We will also use a dataset with general information about countries and try to explain from them the friendship characteristics.

# Datasets Presentation

To understand how friendship is expressed we use two datasets from worldwide social media: Gowalla and BrightKite. Each one of these datasets is composed of two different datasets. The first registers all the checkins, with each time who did checkin, where and when. The second is the friendship relationship between users. We consider here undirected friendship (i.e. both have to be friends). Combining the two datasets we have around 10.9 millions of checkins, 250k users and 1.1 million edges (friendships). Below we show a typical checkin line from the dataset. Data were collected from Feb. 2009 to Oct. 2010 for Gowalla and from Apr. 2008 to Oct. 2010 for BrightKite.

![checkin_sample](https://asreva.github.io/typical_checkin.jpg){: .mx-auto.d-block :}

We also use three datasets that have general information about countries:
1. Compilation of UNData: <https://www.kaggle.com/sudalairajkumar/undata-country-profiles>. Different characteristics for each country.
2. Compilation of USGovt: <https://www.kaggle.com/fernandol/countries-of-the-world>. More characteristics for each country.
3. happiness2020.pkl and countries_info.csv from "tutorial 01- Handling data". More characteristics for each country.
We do not enumerate all the characteristics as they are many of them.

# Preprocessing
## Data extraction and merging
The most funny part... Here we fought against the different format of each dataset. For example, some datasets contained "~0" instead of 0 and ".../..." to indicate that the ratio was not availible. A lot of issues also came from the countries names, that were differing (United States or United States of America). We decided to convert all the country names to the alpha-3 notation that uses three letters to represent each country (however some country have the same like best and worst Korea). We also had to remove territories that have a special status and were considered as countries (like Guadeloupe) but were refered with the same alpha-3 code that the country to which they are associated. Eventually we remained with 127 countries and 40 features for each country. Gowalla and BrightKite have also been merged.

![all_countries](https://asreva.github.io/all_countries.png){: .mx-auto.d-block :}

## Place of residence computation
For each user we computed its place of residence (i.e. its home). We followed the methodology proposed in the paper *Friendship and Mobility: User Movements in Location-Based Social Networks*, by Eunjoon Cho et al. They propose to discretize the world in square of 25kmx25km and to compute for each user the square with more checkins and then, to do assign the house as the mean of all the checkins position inside this square. Note that they used the same social network datasets than us. From the home position, we were able to compute the country of residence of each user.

## Data reduction
40 features is a lot and not all of them where relevant, so we decided to remove some of them. In the end, we kept 26 features that may influence friendship. For exmaple: the hapiness score of the country, the population density, the GDP and other economy indicators as well as education and healthcare.<span style="color:blue">WRITE THEM ALL?</span>

Not all countries are good candidates for our study. We have to ensure that the country has enough users so our result is relevant. Below you can see the countries colored in function of their density of users. Countries in white are not in our dataset. Countries in green have more than one user per 10'000 inhabitants, in blue more than one per 100'000, in red more than one per one million and black less than one per million. <span style="color:blue">CHANGE DESCRIPTIOn</span>

![density_countries](https://asreva.github.io/density_countries.png){: .mx-auto.d-block :}

We see that most of the countries have a very small density of users and so are not relevant. We decided to only keep the country with more than one user per 100'000 inhabitants. Density is not all, in order to study the friendship behaviour we have to ensure that a minimum cluster of people that may be friend exists in the country, that why we added a second selection criteria: a minimum of users in the country. It has been fixed to 100. <span style="color:blue">DISCUSS NB CHOICE</span> In the end we have 41 countries, they are represented below.

![countries_end](https://asreva.github.io/countries_end.png){: .mx-auto.d-block :}

# Friendship characteristics
## Computation
### Quantitative
First, we are intersted on the quantitative aspect of friendship, in the following table we present them:

| Name        | Description |
| ------------- |-------------|
| Nb of friends      | The number of friends that the user has. |
| Nb of friends in the same country      | The number of friend that the user has in the country where she/he lives.| 
| Ratio of friends in the same country | The number of friends in the same country divided by the total number of friends.|
| Nb of friends near | The number of friends that the user has in a radius of 50km around his/her home.|
| Ratio of friends near | The number of friends in the near divided by the total number of friends.|

### Qualitative
We also want to inspect the notion of quality that we can interpret as closeness. To do so we use the following features:

| Name        | Description |
| ------------- |-------------|
| Avg nb of meeting      | The number of times that a user meets with her/his friends. |
| Nb of meeting with his/her bestfriend | The number of meeting that the user had with her/his bestfriend..| 
| Nb of friends met | The number of friends that the user has met at least one time.|

We consider that two users met if they checked in the same place with in a 15min interval. The bestfriend is the friend that the user met the most. The bestfriend information has been created because most of the friends never met, as consequence the distribution of meetings is hard to deal with. We hope that the number of meeting with the bestfriend may represent in a better way the meeting interaction between friends.

### Result
For each user, we compute her/his characteristics:
![friendship_infos](https://asreva.github.io/friendships_infos.jpg){: .mx-auto.d-block :}
Then, we regroup all the users information with respect to their country and we compute the mean of each feature for each country. Note that, when availible, we only keep the ratio and not raw numbers. 
![friends_infos_country](https://asreva.github.io/friendships_infos_country.jpg){: .mx-auto.d-block :}

## Inspection
Now that we have computed the friendship characteristics we can inspect them to see if the features seem to vary depending on the country. We will show that the features change in function of the country.

### Clustering
One first and naive way is to perform clustering on the friendship features of each country to see if some countries share similar behaviours (data have been standarized before). We use Gaussisan Model Mixture for the clustering, as it provides more flexibility than K-means that assumes spherical clusters. We computed it for a number of clusters varying from one to the total number of countries and evaluated the AIC and BIC metrics. These metrics have to be minimized, their results is plotted below as well as the cluster assignement.

![aic_bic](https://asreva.github.io/aic_bic_friendship.png){: .mx-auto.d-block :}
![cluster_friendship](https://asreva.github.io/cluster_friendship.png){: .mx-auto.d-block :}

The optimal number of clusters is around 12 clusters, which indicates us that the friendships characteristics vary among countries. In opposite, when applying the same cluster method to the countries features the optimal number of clusters is 3, which reveals some common relations, you can find their cluster assignment below. Interestingly, North, West and South Europe are quite well clustered. The importance of economy in the general country features may explain this separation.

![cluster_general](https://asreva.github.io/cluster_general.png){: .mx-auto.d-block :}

### PCA
An other way to see that the features vary in function of the country is to use the loadings of the Principal Component Analysis (PCA). First, we apply a standard PCA on the whole friendship and general information about country space to find the principal components (PC), for each PC, we can compute its loadings (how much each initial feature influenced it). The PCs that explain 95% of the variance have the following principal initial feature: <span style="color:blue">ADD DISCUSSION</span>.

### Boxplots
A more robust way to analyse the data is to plot the boxplot of each feature among the countries, i.e. inside a country what is the distribution of the feature.

![cluster_general](https://asreva.github.io/boxplot_quant.png){: .mx-auto.d-block :}

<span style="color:blue">ADD DISCUSSION</span>

![cluster_general](https://asreva.github.io/boxplot_qual.png){: .mx-auto.d-block :}

<span style="color:blue">ADD DISCUSSION</span>

### Statistical tests
Now that we saw that some features seem to have different among countries we want to verify that in a statistical way.

#### One-way ANOVA test
One-way ANOVA (ANalysis Of the VAriance) is one way to do it. The null hypothesis of this method assumes that samples in all groups are generated by populations with the same mean and that this generation is normal. If we refut the null hypothesis it means that at least one population is generated by a different mean. Here our samples are the value of the friendship charachteristic and the groups are the country. In the following table we present the results for the One-way ANOVA tests:

| Feature        | P-value |
| ------------- |-------------|
| Nb of friends      | < 0.001 |
| Ratio of friends in the same country | 0 |
| Ratio of friends near | <0.01|
| Avg nb of meeting      | 0.296 |
| Nb of meeting with his/her bestfriend | 0.03 | 
| Nb of friends met | <0.01|

<span style="color:blue">ADD DISCUSSION</span>

However, these results have to be considered with precaution as it is not sure if the normal condition is satisfied. For example, if we plot the histogram of the average meetings in Canada we see that the distribution is more similar to a power-law than a normal. The distribution is similar for other countries.

![cluster_general](https://asreva.github.io/hist_anova.jpg){: .mx-auto.d-block :}

#### Kruskal-Wallis test
The Kruskal-Wallis test does not assume the normal distribution. This time, the null hypothesis is that the median of each group is the same. The computation give us:

| Feature        | P-value |
| ------------- |-------------|
| Nb of friends      | < 0.001 |
| Ratio of friends in the same country | 0 |
| Ratio of friends near |  < 0.001|
| Avg nb of meeting      |  < 0.001|
| Nb of meeting with his/her bestfriend |  < 0.001 | 
| Nb of friends met |  < 0.001|

<span style="color:blue">ADD DISCUSSION</span>

# Relation between countries and friendship features
In this chapter we will try to understand how the countries charachteristics can influence the friendships ones.

## Pairplot
Firt, let's take a glance at the pairplot.

![cluster_general](https://asreva.github.io/pairplot.png){: .mx-auto.d-block :}

<span style="color:blue">ADD DISCUSSION</span>

## Correlation matrix
An other visualization is the correlation matrix.

![cluster_general](https://asreva.github.io/correlation.jpg){: .mx-auto.d-block :}

From the correaltion we can infer which ones of the features seem to have influence.
<span style="color:blue">ADD DISCUSSION</span>

## Regression
However, knowing that the feature has seem to have an influence is not sufficient. It is also necessary to see what is the confidence that we can give. That it is why we apply a regression from all the countries features to the each friendship charachteristic. Note that before regression data are standarized and that we will only display the features that have less than 0.05 of p-value.

### Friends near

| Feature        | Coef | P-value|
| ------------- |-------------|-------------|
|X|X|X|
|X|X|X|
|X|X|X|
<span style="color:blue">ADD DISCUSSION</span>

### Friends in the same country

| Feature        | Coef | P-value|
| ------------- |-------------|-------------|
|X|X|X|
|X|X|X|
|X|X|X|
<span style="color:blue">ADD DISCUSSION</span>

### Total number of friends

| Feature        | Coef | P-value|
| ------------- |-------------|-------------|
|X|X|X|
|X|X|X|
|X|X|X|
<span style="color:blue">ADD DISCUSSION</span>

### Average number of meetings

| Feature        | Coef | P-value|
| ------------- |-------------|-------------|
|X|X|X|
|X|X|X|
|X|X|X|
<span style="color:blue">ADD DISCUSSION</span>

### Number of friends met

| Feature        | Coef | P-value|
| ------------- |-------------|-------------|
|X|X|X|
|X|X|X|
|X|X|X|
<span style="color:blue">ADD DISCUSSION</span>

### Number of best friends meetings

| Feature        | Coef | P-value|
| ------------- |-------------|-------------|
|X|X|X|
|X|X|X|
|X|X|X|
<span style="color:blue">ADD DISCUSSION</span>

## Matching
We discovered that some feature have an impact on the friendship, however we want to verify that the impact is a real one.
<span style="color:blue">TO DO</span>


# Discussion
<span style="color:blue">CRITICS</span>

# Conclusion
<span style="color:blue">CONCLUDE</span>
